## Human Pose Estimation
This module contains scripts to estimate human keypoints coordinates using MMPose. 
Script **run_hpe.py** allows to generate keypoints for video sequences and sequence of images. 

### Options:
- *mmpose-path* - absolute path to MMPose project (if not set, by default is used this one, set in config.ini from main project directory)
- *hpe-method* - used HPE algorithm (by default *res152_coco_384x288*)
- *output-directory* - directory where results (keypoints coordinates) will be generated (default is *./results*)
- *dataset-path* - absolute path to input dataset (**required**)
- *video* - flag that defines if given input data are video sequences or multiple images (by default it is assumed that input is array of immages)
- *filter* - filter input files of dataset
- *generate-video*  - flag that defines if MMPose should generate output videos with marked estimated keypoints on them

Output contains poses and bounding box-es for analysed sequences. 

MMPose installation and configuration process is described here: https://github.com/open-mmlab/mmpose
MMPose require also MMDetection to be installed: https://github.com/open-mmlab/mmdetection
All available methods are mentioned in *./hpe_utils/bottom_up_config.py* and *./hpe_utils/top_down_config.py*.

### Examples

#### Video sequence

Example command:

```
python run_hpe.py \
    --mmpose-path /home/user/mmpose \
    --dataset-path /home/user/dataset/cluster1 \
    --video
```

The most important point for video sequence is adding *--video* flag (without that, all videos in directory will be treated as images).
Dataset can contains multiple nested directories, but having this same structure (depth).

Below You can see an example dataset tree:

```
dataset/
├─ cluster1/
│  ├─ cam1/
│  │  ├─ action1/
│  │  │  ├─ video_001.avi
│  │  │  ├─ video_002.avi
│  │  │  ├─ video_003.avi
│  │  ├─ action2/
│  │  │  ├─ video_001.avi
│  │  │  ├─ video_002.avi
│  │  │  ├─ video_003.avi
│  ├─ cam2/
│  │  ├─ action1/
│  │  │  ├─ video_001.avi
│  │  │  ├─ video_002.avi
│  │  │  ├─ video_003.avi
│  │  ├─ action2/
│  │  │  ├─ video_001.avi
│  │  │  ├─ video_002.avi
│  │  │  ├─ video_003.avi

```
\* in case of any problem You need to ensure that the deepest folder contains only videos

Output structure:

```
results/
├─ cluster1/
│  ├─ cam1/
│  │  ├─ action1/
│  │  │  ├─ res152_coco_384x288
│  │  │  │  ├─  csv
│  │  │  │  │  ├─  bbox
│  │  │  │  │  |  ├─  video_001
│  │  │  │  │  |  |  ├─  video_001_bounding_box_0.csv
│  │  │  │  │  |  |  ├─  video_001_bounding_box_1.csv
│  │  │  │  │  |  ├─  video_002
│  │  │  │  │  |  |  ├─  video_002_bounding_box_0.csv
│  │  │  │  │  |  |  ├─  video_002_bounding_box_1.csv
│  │  │  │  │  ├─  pose_results
│  │  │  │  │  |  ├─  video_001
│  │  │  │  │  |  |  ├─  video_001_pose_0.csv
│  │  │  │  │  |  |  ├─  video_001_pose_1.csv
│  │  │  │  │  |  ├─  video_002
│  │  │  │  │  |  |  ├─  video_002_pose_0.csv
│  │  │  │  │  |  |  ├─  video_002_pose_1.csv
```

If *video* options is given, then video directory with sequence generated by MMPose will be placed on the level of csv directory.

#### Images sequence

Example command:

```
python run_hpe.py \
    --mmpose-path /home/user/mmpose \
    --dataset-path /home/user/dataset/cluster1
```

Dataset can contains multiple nested directories, but having this same structure (depth).

Below You can see an example dataset tree:

```
dataset/
├─ cluster1/
│  ├─ cam1/
│  │  ├─ action1/
│  │  │  ├─ img_001.png
│  │  │  ├─ img_002.png
│  │  │  ├─ img_003.png
│  │  ├─ action2/
│  │  │  ├─ img_001.png
│  │  │  ├─ img_002.png
│  │  │  ├─ img_003.png
│  ├─ cam2/
│  │  ├─ action1/
│  │  │  ├─ img_001.png
│  │  │  ├─ img_002.png
│  │  │  ├─ img_003.png
│  │  ├─ action2/
│  │  │  ├─ img_001.png
│  │  │  ├─ img_002.png
│  │  │  ├─ img_003.png

```
\* in case of any problem You need to ensure that the deepest folder contains only videos


Output structure:


```
results/
├─ cluster1/
│  ├─ cam1/
│  │  ├─ action1/
│  │  │  ├─ res152_coco_384x288
│  │  │  │  ├─  csv
│  │  │  │  │  ├─  bbox
│  │  │  │  │  |  ├─  img_001
│  │  │  │  │  |  |  ├─  img_001_bounding_box_0.csv
│  │  │  │  │  |  |  ├─  img_001_bounding_box_1.csv
│  │  │  │  │  |  ├─  img_002
│  │  │  │  │  |  |  ├─  img_002_bounding_box_0.csv
│  │  │  │  │  |  |  ├─  img_002_bounding_box_1.csv
│  │  │  │  │  ├─  pose_results
│  │  │  │  │  |  ├─  img_001
│  │  │  │  │  |  |  ├─  img_001_pose_0.csv
│  │  │  │  │  |  |  ├─  img_001_pose_1.csv
│  │  │  │  │  |  ├─  img_002
│  │  │  │  │  |  |  ├─  img_002_img_pose_0.csv
│  │  │  │  │  |  |  ├─  img_002_img_pose_1.csv
```

If *video* options is given, then video directory with sequence generated by MMPose will be placed on the level of csv directory.